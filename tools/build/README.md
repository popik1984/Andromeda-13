# Сборка проекта /tg/station

Данный скрипт сборки является рекомендуемым способом компиляции игры.
Он собирает не только код на DM, но также JavaScript и все прочие зависимости.

- VSCode:
	a) Нажмите `Ctrl+Shift+B` для сборки.
	b) Нажмите F5 для сборки и запуска с подключенным отладчиком.
- Windows:
	a) Дважды щелкните файл `BUILD.bat` в корне репозитория для сборки (по завершении окно закроется после нажатия любой клавиши).
	b) Дважды щелкните файл `tools/build/build.bat` для сборки (окно закроется сразу после завершения сборки).
- Linux:
  a) Выполните `tools/build/build.sh` из корня репозитория.

Скрипт пропускает шаги сборки, исходные данные для которых не изменились с момента последнего запуска.

## Получение списка доступных целей сборки

Вы можете получить список всех целей сборки, выполнив следующую команду:

```
tools/build/build.sh --help
```

## Зависимости

- В Windows `build.bat` автоматически установит приватную (локальную) копию Node.
- В Linux установите Node с помощью вашего менеджера пакетов или с сайта <https://nodejs.org/en/download/>.
- В Linux, если вы не используете tgs4 или более новую версию, вам потребуется скомпилировать rust-g на сервере и получить файл .so. Инструкции см. по ссылке: https://github.com/tgstation/rust-g

## Зачем?

Раньше мы включали скомпилированные версии JavaScript-кода tgui в репозиторий Git, чтобы проект можно было собрать, используя только BYOND. Эти предварительно скомпилированные файлы часто вызывали конфликты слияния без видимых причин. Использование скрипта сборки позволяет избежать этой проблемы, сохраняя удобство сборки для тех, кто не изменяет tgui.

Данный скрипт сборки основан на [Juke Build](https://github.com/stylemistake/juke-build) - перейдите по ссылке, чтобы прочитать документацию по проекту, понять, как он работает и как внести вклад в его разработку.

## Именованные версии BYOND

Если у вас установлено несколько версий BYOND в нестандартных расположениях или вы хотите использовать несколько версий одновременно для тестирования, вы можете заполнить файл `dm_versions.json` в этой директории.
Записи с "default": true будут использоваться ПЕРЕД установками BYOND в стандартных расположениях. В противном случае вам нужно передать аргумент `--dm-version={name}` скрипту сборки, чтобы выбрать нужную версию.
Пример файла `dm_versions.json`:

```
[
  {
    "name": "515.1594",
    "path": "C:\\Repo\\ByondVersions\\515.1594_byond\\byond\\bin\\dm.exe",
    "default": false
  },
  {
    "name": "funny_version",
    "path": "D:\\Repo\\ByondVersions\\514.1589_byond\\byond\\bin\\dm.exe",
    "default": true
  }
]
```
